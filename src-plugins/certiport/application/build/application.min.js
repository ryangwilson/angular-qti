/*
* application 0.1.0
*/
!function(a,b){b.application=a,angular.module("certiport.plugin",[]),angular.module("certiport",["certiport.plugin"]);var c={};c.APP_INIT="app.events.init",c.APP_READY="app.events.ready",c.SLIDE_INIT="slide.events.init",c.SLIDE_READY="slide.events.ready",String.supplant||(String.prototype.supplant=function(a){return this.replace(/{([^{}]*)}/g,function(b,c){var d=a[c];return"string"==typeof d||"number"==typeof d?d:b})}),angular.module("certiport").directive("click",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.click)};b.parent().on("click",d),a.$on("$destroy",function(){b.parent().off("click",d)})}}}),angular.module("certiport").directive("dblclick",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.dblclick)};b.parent().on("dblclick",d),a.$on("$destroy",function(){b.parent().off("dblclick",d)})}}}),angular.module("certiport").directive("mousedown",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mousedown)};b.parent().on("mousedown",d),a.$on("$destroy",function(){b.parent().off("mousedown",d)})}}}),angular.module("certiport").directive("mouseenter",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseenter)};b.parent().on("mouseenter",d),a.$on("$destroy",function(){b.parent().off("mouseenter",d)})}}}),angular.module("certiport").directive("mouseleave",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseleave)};b.parent().on("mouseleave",d),a.$on("$destroy",function(){b.parent().off("mouseleave",d)})}}}),angular.module("certiport").directive("mousemove",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mousemove)};b.parent().on("mousemove",d),a.$on("$destroy",function(){b.parent().off("mousemove",d)})}}}),angular.module("certiport").directive("mouseover",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseover)};b.parent().on("mouseover",d),a.$on("$destroy",function(){b.parent().off("mouseover",d)})}}}),angular.module("certiport").directive("mouseup",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseup)};b.parent().on("mouseup",d),a.$on("$destroy",function(){b.parent().off("mouseup",d)})}}}),angular.module("certiport").directive("application",["$http","$compile","$q","$timeout","XMLService","DataService",function(a,b,d,e,f,g){return{restrict:"AE",scope:!0,controller:["$scope","$element","$attrs",function(h,i,j){var k,l="sim-",m="{{",n="}}",o="{%",p="%}",q="\n",r=0,s=[],t={},u={slideCount:0,virtualCount:0};h.extension=j.extension,h.url=h.$eval(j.url),h.$$data={};var v=g.data(h.$$data);h.$$strings={};var w=function(a){r+=1,console.log("%cinc("+r+"): "+a,"color: #27ae60")},x=function(a){r-=1,console.log("%cdec("+r+"): "+a,"color: #c0392b")},y=[];h.addSlideInterceptor=function(a){y.push(a)},h.set=function(a,b,c){return c=c||"/",-1!==a.indexOf("::")&&(a=a.split("::").join("|").split(c).join("|"),c="|"),v.set(a,b,c)},h.get=function(a,b){return b=b||"/",-1!==a.indexOf("::")&&(a=a.split("::").join("|").split(b).join("|"),b="|"),v.get(a,b)},h.watch=function(a,b,c){if(!h.isBindable(a))return e(function(){b(a)},0),function(){};var d="/";return a=a.substring(2,a.length-2),-1!==a.indexOf("::")&&(a='$$data["'+a.split("::").join("|").split(d).join("|").split("|").join('"]["')+'"]'),h.$watch(a,function(a){a&&b(a)},c)};var z=function(a){return a.replace(/<([\w|-]+)(\s.*)\/>/gim,"<$1$2></$1>")},A=function(a){return angular.forEach(s,function(b){a=a.replace(b,"<$1sim-$2$3")}),a},B=function(a){return a=a.replace(/\$([\w\.]+)/gim,"{{::@@strings.$1}}"),a=a.split("@@").join("$$")},C=function(a){for(var b=angular.element("<div>"+a+"</div>"),c=b[0].childNodes,d=c.length,e=0;d>e;e++)c[e]&&1===c[e].nodeType&&(c[e].outerHTML=c[e].outerHTML.split(m).join(o).split(n).join(p));return b.html()},D=function(a){"string"==typeof a&&(a=a.split(" "));var b=a;angular.forEach(b,function(a){a&&(k=new RegExp("<(/?)("+a+")([\\s>])","gm"),s.push(k))})},E=function(a,c){c=A(c),c=c.replace(/name="(\w+)"/gim,'name="'+a+'::$1"');var d=angular.element(c),e=b(d);e(h),i.append(d)};h.isBindable=function(a){return a+="",-1!==a.indexOf(o)},h.curlify=function(a){return a.split(o).join(m).split(p).join(n)},h.loadSlide=function(c){console.log("%cloading slide "+c.templateUrl+" ","color: #bdc3c7"),w(c.templateUrl),u.slideCount+=1;var e=d.defer(),f="{val}.{ext}".supplant({val:c.templateUrl,ext:h.extension||"xml"});return a.get(f).success(function(a){a=z(a),angular.forEach(y,function(b){a=b(a)}),a=A(a),a=C(a),a=B(a),a="<!-- "+c.templateUrl+" -->"+q+a;var d=angular.element(a),g=b(d);g(c.targetScope),c.targetEl.append(d),h.loadVirtuals(a,f).then(function(){console.log("%cvirtuals loaded for "+c.templateUrl,"color: #3498db"),e.resolve()}),x(c.templateUrl)}),e.promise},h.loadVirtuals=function(b){var c=d.defer(),e=b.replace(/<!--[\s\S]*?-->/g,""),g=e.match(/([\w\.\/]+)(?=::)/gim);if(g){var i=0;angular.forEach(g,function(b){if(!t[b]){i+=1,w(b),u.virtualCount+=1,t[b]=!0;var d=".xml";a.get(b+d).success(function(a){var d=a.match(/xmlns\="(.*?)(?=")/gim);if(!d)throw new Error('missing require "xmlns" attribute');var e=d[0].split("/").pop();switch(e){case"model":var g=f.toJson(a);h.set(b,g);break;case"commands":E(b,a)}h.loadVirtuals(a,b).then(function(){c.resolve()}),x(b)})}0===i&&c.resolve()})}else c.resolve();return c.promise},h.parseRegisteredTags=A,h.incCounter=w,h.decCounter=x,i.addClass(l+"cloak"),D(["exec","log","events","event","commands","command","functions","function","properties","listeners","button","slide","mixins","mixin","view","eval","virtual","script","style","link","listener","image","strings"]),h.$watch("url",function(a){if(a){u.startTime=Date.now(),console.log("%c APPLICATION START ","background: #2980b9; color: #fff"),h.$broadcast(c.APP_INIT),h.loadSlide({templateUrl:a,targetScope:h,targetEl:i}).then(function(){});var b,d=h.$watch(function(){e.cancel(b),b=e(function(){1>r&&(d(),console.log("%c %s ","background: #1abc9c; color: #fff; display:block; width: 200px","SLIDE READY",a),h.$broadcast(c.APP_READY),i.removeClass(l+"cloak"),u.endTime=Date.now(),u.totalTime=u.endTime-u.startTime,console.log("%c APPLICATION READY ","background: #27ae60; color: #fff; display:block;"),console.log(""),console.log("%cAPPLICATION REPORT","border-bottom: 1px solid #34495e; color: #666; display:block;"),console.log("%ctime: "+u.totalTime,"color: #34495e; display:block"),console.log("%cslide count: "+u.slideCount,"color: #34495e; display:block"),console.log("%cvirtual count: "+u.virtualCount,"color: #34495e; display:block"),console.log(""),h.$root.$emit("ready"))},0)})}})}]}}]),angular.module("certiport").directive("simButton",function(){return{restrict:"AE",link:function(a,b,c){b.text(c.label)}}}),angular.module("certiport").directive("simImage",["$compile",function(a){return{restrict:"AE",scope:!0,link:function(b,c,d){var e='<img ng-src="{{src}}" ondragstart="return false" />',f=angular.element(e),g=a(f);g(b),c.append(f),b.watch(d.src,function(a){b.src=a,b.incCounter(d.src),f.bind("load",function(){b.decCounter(d.src),b.$$phase||b.$apply()})})}}}]),angular.module("certiport").directive("simSlide",["$log",function(a){return{restrict:"AE",scope:!0,controller:["$scope","$element","$attrs",function(b,d,e){var f="slide_"+b.$id;d.addClass(f),b.properties={},b.functions={},b.registerFunction=function(a,c){b.functions[a]=c},b.invoke=function(a){if("function"==typeof b.functions[a]){var c=b,d=c.getMerged("properties");b.functions[a](c,d)}},b.parseFunctions=function(c){c=c||"";var d,e,f,g=c.match(/(<%=?)((.|\n)*?)(%>)/gim),h=Function;return angular.forEach(g,function(g){d=g.substring(3,g.length-2).trim(),d.match(/\w+\./im)||(d="this."+d);try{e=new h("return ("+d+");").apply(b)}catch(i){try{e=new h("return ("+d+");").apply(b.functions)}catch(i){try{e=new h("return ("+d+");").apply(window)}catch(i){a.warn("Could not invoke: "+d)}}}g=g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),f=new RegExp(g,"im"),c=c.replace(f,e||"")}),c},b.getMerged=function(a){for(var c=[{}],d=b;d.$parent&&(d=d.$parent,d[a]);)c.push(d[a]);return c.push(b[a]),angular.extend.apply(null,c)},b.watch(e.url,function(a){b.$$url=a,b.loadSlide({templateUrl:a,targetEl:d,targetScope:b}).then(function(){var d=b,e=d.getMerged("properties");window.console.log("%cslide loaded "+a,"color: #8e44ad"),b.$broadcast(c.SLIDE_INIT,d,e);var f=b.$on(c.APP_READY,function(){f();var d=b,e=d.getMerged("properties");window.console.log("%c %s ","background: #1abc9c; color: #fff; display:block","SLIDE READY",a),b.$broadcast(c.SLIDE_READY,d,e)})})})}]}}]),angular.module("certiport").service("DataService",function(){function a(a){this.data=a||{}}var b=a.prototype;b.get=function(a,b){for(var c=a.split(b||"."),d="",e=0,f=c.length,g=this.data;f>e&&(d=c[e],g=g[d],void 0!==g);)e+=1;return g},b.set=function(a,b,c){for(var d=a.split(c||"."),e="",f=0,g=d.length-1,h=this.data;g>f;)e=d[f],h=void 0===h[e]?h[e]={}:h[e],f+=1;return d.length>1&&(h[d.pop()]=b),this.data},b.path=function(a){return this.set(a,{})},this.data=function(b){return new a(b)}}),angular.module("certiport").service("helpers",function(){var a=function(a){var b,c;return window.DOMParser?(b=new DOMParser,c=b.parseFromString(a,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)),c},b=function(a){var c={};if(1===a.nodeType){if(a.attributes.length>0){c["@attributes"]={};for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c["@attributes"][e.nodeName]=e.value}}}else 3===a.nodeType&&(c=a.nodeValue.trim());if(a.hasChildNodes())for(var f=0;f<a.childNodes.length;f++){var g=a.childNodes.item(f),h=g.nodeName;if("undefined"==typeof c[h])"#text"!==h?c[h]=b(g):g.nodeValue.trim()&&(c=g.nodeValue.trim());else{if("undefined"==typeof c[h].push){var i=c[h];c[h]=[],c[h].push(i)}c[h].push(b(g))}}return c};this.strToXML=a,this.xmlToJson=b}),angular.module("certiport").service("json",function(){this.parse=function(a,b){function c(a){throw{name:"SyntaxError",message:a,at:o,text:r}}function d(a){return a&&a!==p&&c("Expected '"+a+"' instead of '"+p+"'"),p=r.charAt(o),o+=1,p}function e(){var a="";if('"'===p)for(;d();){if('"'===p)return d(),a;if("\\"===p)if(d(),"u"===p){for(var b=0,e=0;4>e;e+=1){var f=parseInt(d(),16);if(!isFinite(f))break;b=16*b+f}a+=String.fromCharCode(b)}else{if("string"!=typeof q[p])break;a+=q[p]}else a+=p}c("Bad string")}function f(){for(;p&&" ">=p;)d()}function g(){for(var a="";k();)a+=p,d();return"true"===a?!0:"false"===a?!1:"null"===a?null:/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?$/.test(a)?parseFloat(a):a}function h(){var a=[];if("["===p){if(d("["),f(),"]"===p)return d("]"),a;for(;p;){if(a.push(j()),f(),"]"===p)return d("]"),a;d(","),f()}}c("Bad array")}function i(){var a={};if(p===l){if(d(l),f(),p===m)return d(m),a;for(;p;){var b='"'===p?e():g();if("string"!=typeof b&&c("Bad object key: "+b),f(),d(n),Object.hasOwnProperty.call(a,b)&&c('Duplicate key: "'+b+'"'),a[b]=j(),f(),p===m)return d(m),a;d(","),f()}}c("Bad object")}function j(){switch(f(),p){case l:return i();case"[":return h();case'"':return e();default:return g()}}function k(){switch(p){case'"':case"\\":case"	":case"\n":case"\r":case",":case"[":case"]":case l:case m:case n:return!1}return p>" "}"undefined"==typeof b&&(b=!0);var l=b?"{":"(",m=b?"}":")",n=b?":":"=",o=0,p=" ",q={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},r=a,s=j();return f(),p&&c("Syntax error"),s}}),function(){var a=function(c){function d(a){return isNaN(a)?"true"===a?!0:"false"===a?!1:a:Number(a)}function e(a,b){i[a]?(i[a].constructor!==Array&&(i[a]=[i[a]]),i[a][i[a].length]=d(b)):i[a]=d(b)}function f(a,b){i[a].text=b}"string"==typeof c&&(c=b(c).firstElementChild);var g,h,i={};for(g=0;c.attributes[g];g++)h=c.attributes[g],e(h.name,h.value);for(g=0;c.childNodes[g];g++)h=c.childNodes[g],1===h.nodeType&&(1===h.childNodes.length&&3===h.firstChild.nodeType?h.attributes.length?(e(h.nodeName,a(h)),f(h.nodeName,h.firstChild.nodeValue)):e(h.nodeName,h.firstChild.nodeValue):e(h.nodeName,a(h)));return i},b=function(a){var b,c;return window.DOMParser?(b=new DOMParser,c=b.parseFromString(a,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)),c},c=function(a){var b;return b=window.ActiveXObject?a.xml:(new XMLSerializer).serializeToString(a),b=b.replace(/\sxmlns=".*?"/gim,"")};angular.module("certiport").service("XMLService",function(){this.toJson=a,this.toString=c,this.parse=b})}(),angular.module("certiport").directive("simEval",["$interpolate",function(a){return{restrict:"AE",link:function(b,c){var d=c.text();d=b.curlify(d),b.registerAction(function(c,e){var f=a(d),g=f(e);console.log("whoisscope",b.functions.uppercase,g);var h=Function,i=new h("return ("+g+");").apply(b);return void 0===i?i:void 0})}}}]),angular.module("certiport").directive("simExec",["$interpolate","$rootScope","json",function(a,b,c){return{restrict:"AE",link:function(d,e,f){var g=e.text();g=d.curlify(g),d.registerAction(function(d,e){var h=a(g),i=h(e),j=c.parse(i);return b.$broadcast(f.command,d,j),j}),e.empty()}}}]),angular.module("certiport").directive("simLog",["$rootScope","$interpolate",function(a,b){return{restrict:"AE",link:function(a,c,d){var e=c.text();e=a.curlify(e),a.registerAction(function(a,c){var f=b(e),g=f(c);g=a.parseFunctions(g),d.debug?console.log("%c%s%c %s","background: #e67e22; color: #fff; display:block","[DEBUG::"+a.$$url+"]","background: #fff; color: #000; display:block",g):console.info(g)}),c.remove()}}}]),angular.module("certiport").directive("simCommand",["$rootScope","$log",function(a,b){var c={};return{restrict:"AE",scope:!0,link:function(a,b){b.remove()},controller:["$scope","$attrs",function(d,e){var f;b.log("%ccommand added: "+e.name,"color: #8e44ad"),d.actions=[],d.registerAction=function(a){d.actions.push(a)},c[e.name]||(c[e.name]=!0,a.$on(e.name,function(a,b,c){angular.forEach(d.actions,function(a){"function"==typeof a&&(f=a(b,c),"undefined"!=typeof f&&(c=f))})}))}]}}]),angular.module("certiport").directive("simFunction",function(){return{restrict:"AE",scope:!0,link:function(a,b){b.remove()},controller:["$scope","$attrs",function(a,b){var c;a.actions=[],a.registerFunction(b.name,function(b,d){angular.forEach(a.actions,function(a){"function"==typeof a&&(c=a(b,d),"undefined"!=typeof c&&(d=c))})}),a.registerAction=function(b){a.actions.push(b)}}]}}),angular.module("certiport").directive("simLink",["$http",function(a){var b={};return{restrict:"AE",controller:["$scope","$element","$attrs",function(c,d,e){var f=".slide_"+c.$id;if(e.href){var g=e.href;if(!b[g]){b[g]=!0;var h="{val}".supplant({val:g});a.get(h).success(function(a){a=a.replace(/([\#\.\D]{1}[A-Za-z]{1}[\w\.\s]+)(,|\{)/g,function(a,b,c){return(f+" "+b.trim()+c).trim()}),d[0].outerHTML="<style>"+a+"</style>"})}}}]}}]),angular.module("certiport").directive("simListener",["$interpolate",function(a){return{restrict:"AE",link:function(a,b){b.remove()},controller:["$scope","$attrs",function(b,c){b.$on(c.on,function(d,e,f){var g=c.handler,h=g.match(/^\w+/im)[0];if(b.functions[h]){var i=g.indexOf("("),j=g.lastIndexOf(")");if(-1===i)g+="(this)";else{var k=g.substr(0,i+1),l=g.substr(i+1);g=g.substr(i,j).match(/\w+/im)?k+"this, "+l:k+"this"+l}g="functions."+g,g=b.curlify(g);var m=a(g),n=m(f);b.$eval(n)}})}]}}]),angular.module("certiport").directive("simMixin",["$http","$compile",function(a,b){var c={};return{restrict:"AE",scope:!0,link:function(a,b){b.remove()},controller:["$scope","$element","$attrs",function(d,e){var f=e.html();if(!c[f]){c[f]=!0;var g="{val}.{ext}".supplant({val:f,ext:"xml"});a.get(g).success(function(a){a=d.parseRegisteredTags(a);var c=angular.element(a),f=b(c);e.append(c),f(d)})}}]}}]),angular.module("certiport").directive("bottom",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.bottom).match(/\d+/),e=String(c.bottom).match(/\D+/)||"px";b.css("position","absolute"),b.css("bottom",d+e)}}}),angular.module("certiport").directive("height",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.height).match(/\d+/),e=String(c.height).match(/\D+/)||"px";b.css("height",d+e)}}}),angular.module("certiport").directive("left",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.left).match(/\d+/),e=String(c.left).match(/\D+/)||"px";b.css("position","absolute"),b.css("left",d+e)}}}),angular.module("certiport").directive("right",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.right).match(/\d+/),e=String(c.right).match(/\D+/)||"px";b.css("position","absolute"),b.css("right",d+e)}}}),angular.module("certiport").directive("top",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.top).match(/\d+/),e=String(c.top).match(/\D+/)||"px";b.css("position","absolute"),b.css("top",d+e)}}}),angular.module("certiport").directive("width",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.width).match(/\d+/),e=String(c.width).match(/\D+/)||"px";b.css("width",d+e)}}}),angular.module("certiport").directive("x",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.x).match(/\d+/),e=String(c.x).match(/\D+/)||"px";b.css("position","absolute"),b.css("left",d+e)}}}),angular.module("certiport").directive("y",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.y).match(/\d+/),e=String(c.y).match(/\D+/)||"px";b.css("position","absolute"),b.css("top",d+e)}}}),angular.module("certiport").directive("simProperties",["helpers",function(a){return{restrict:"AE",link:function(b,c){var d="<props>"+c.html()+"</props>",e=a.strToXML(d),f=a.xmlToJson(e);angular.extend(b.properties,f.props),c.remove()}}}]),angular.module("certiport").directive("simScript",["$http","$compile",function(a){var b={};return{restrict:"AE",link:function(a,b){b.remove()},controller:["$scope","$element","$attrs",function(c,d,e){if(e.src){var f=e.src;if(!b[f]){b[f]=!0;var g="{val}".supplant({val:f});a.get(g).success(function(a){var b=Function;new b(a).apply(c.functions)})}}else{var h=d.html(),i=Function;new i(h).apply(c.functions)}}]}}]),angular.module("certiport").directive("simStrings",["$http","XMLService",function(a,b){return{restrict:"AE",link:function(c,d,e){c.incCounter(e.url);var f=".xml";a.get(e.url+f).success(function(a){var d=b.toJson(a);angular.extend(c.$$strings,d),c.loadVirtuals(a).then(function(){c.decCounter(e.url)})}),d.remove()}}}]),angular.module("certiport").directive("simStyle",function(){return{restrict:"AE",controller:["$scope","$element","$attrs",function(a,b){var c=".slide_"+a.$id,d=b.html();d=d.replace(/([\#\.\D]{1}[A-Za-z]{1}[\w\.\s]+)(,|\{)/g,function(a,b,d){return(c+" "+b.trim()+d).trim()}),b[0].outerHTML="<style>"+d+"</style>"}]}}),angular.module("certiport").directive("backgroundColor",function(){return{restrict:"A",link:function(a,b,c){b.css("backgroundColor",c.backgroundColor)}}}),angular.module("certiport").directive("simVirtual",function(){return{restrict:"AE",link:function(a,b){b.remove()}}})}({},function(){return this}());