/*
* application 0.1.0
*/
!function(a,b){b.application=a,function(){function a(a){this.name=a,this.config={},this.views={},this.plugins={$$cache:{}},hb.dispatcher(this)}var b={};a.prototype.init=function(a){return angular.extend(this.config,a),this},a.prototype.view=function(a,b){if("undefined"==typeof b){var c=this.views[a];if(!c)throw new Error("View not registered with name: {name}.").supplant({name:a});return c}return this.views[a]=b,this},a.prototype.registerPlugin=function(a,b){return this.plugins[a]=b,this},a.prototype.getPlugin=function(a){if(!this.plugins.$$cache[a]){var b=this.plugins[a];if(!b)throw new Error("Plugin not registered with name: {name}.").supplant({name:a});this.plugins.$$cache[a]=b()}return this.plugins.$$cache[a]},a.prototype.getViewElement=function(a,b){var c=this,d=c.view(a);b=extend({},d,b);var e,f=c.renderElement(d.name,b);return angular.forEach(b.plugins,function(a){e=c.getPlugin(a.name,a.options),console.warn("THIS IS BEING REFACTORED")}),f},a.prototype.renderElement=function(a,b){var c="<{tag_name}></{tag_name}>",d=c.supplant({tag_name:a}),e=angular.element(d);return angular.forEach(b.attrs,function(a,b){e.attr(b,a)}),e},window.application=function(c){return b[c]||(b[c]=new a(c)),b[c]}}(),angular.module("certiport.plugin",[]);var c=angular.module("certiport",["certiport.plugin"],["$compileProvider","$controllerProvider",function(a,b){c.api.consts.$compileProvider=a,c.api.consts.$controllerProvider=b}]);c.api={},c.api.consts={},c.api.directives={},c.api.directive=function(a,b){c.api.directives[a]=b},c.api.applyDirectives=function(){angular.forEach(c.api.directives,function(a,b){c.directive(b,a)})};var d={};d.APP_INIT="app.events.init",d.APP_READY="app.events.ready",d.SLIDE_INIT="slide.events.init",d.SLIDE_READY="slide.events.ready",angular.module("certiport").directive("click",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.click)};b.parent().on("click",d),a.$on("$destroy",function(){b.parent().off("click",d)})}}}),angular.module("certiport").directive("dblclick",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.dblclick)};b.parent().on("dblclick",d),a.$on("$destroy",function(){b.parent().off("dblclick",d)})}}}),angular.module("certiport").directive("mousedown",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mousedown)};b.parent().on("mousedown",d),a.$on("$destroy",function(){b.parent().off("mousedown",d)})}}}),angular.module("certiport").directive("mouseenter",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseenter)};b.parent().on("mouseenter",d),a.$on("$destroy",function(){b.parent().off("mouseenter",d)})}}}),angular.module("certiport").directive("mouseleave",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseleave)};b.parent().on("mouseleave",d),a.$on("$destroy",function(){b.parent().off("mouseleave",d)})}}}),angular.module("certiport").directive("mousemove",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mousemove)};b.parent().on("mousemove",d),a.$on("$destroy",function(){b.parent().off("mousemove",d)})}}}),angular.module("certiport").directive("mouseover",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseover)};b.parent().on("mouseover",d),a.$on("$destroy",function(){b.parent().off("mouseover",d)})}}}),angular.module("certiport").directive("mouseup",function(){return{restrict:"A",link:function(a,b,c){var d=function(b){b.stopPropagation(),window.event=b,a.invoke(c.mouseup)};b.parent().on("mouseup",d),a.$on("$destroy",function(){b.parent().off("mouseup",d)})}}}),angular.module("certiport").directive("application",["$http","$compile","$q","$timeout",function(a,b,c,e){return{restrict:"AE",scope:!0,controller:["$scope","$element","$attrs",function(f,g,h){var i,j="sim-",k="{{",l="}}",m="{%",n="%}",o="\n",p=0,q=[],r={},s={slideCount:0,virtualCount:0};f.extension=h.extension,f.url=f.$eval(h.url),f.plugins=f.$eval(h.plugins),f.$$data={};var t=hb.resolve(f.$$data);f.$$strings={};var u=function(a){p+=1,console.log("%cinc("+p+"): "+a,"color: #27ae60")},v=function(a){p-=1,console.log("%cdec("+p+"): "+a,"color: #c0392b")},w=[];f.addSlideInterceptor=function(a){w.push(a)},f.set=function(a,b,c){return c=c||"/",-1!==a.indexOf("::")&&(a=a.split("::").join("|").split(c).join("|"),c="|"),t.set(a,b,c)},f.get=function(a,b){return b=b||"/",-1!==a.indexOf("::")&&(a=a.split("::").join("|").split(b).join("|"),b="|"),t.get(a,b)},f.watch=function(a,b,c){if(!f.isBindable(a))return e(function(){b(a)},0),function(){};var d="/";return a=a.substring(2,a.length-2),-1!==a.indexOf("::")&&(a='$$data["'+a.split("::").join("|").split(d).join("|").split("|").join('"]["')+'"]'),f.$watch(a,function(a){a&&b(a)},c)};var x=function(a){return a.replace(/<([\w|-]+)(\s.*)\/>/gim,"<$1$2></$1>")},y=function(a){return angular.forEach(q,function(b){a=a.replace(b,"<$1sim-$2$3")}),a},z=function(a){return a=a.replace(/\$([\w\.]+)/gim,"{{::@@strings.$1}}"),a=a.split("@@").join("$$")},A=function(a){for(var b=angular.element("<div>"+a+"</div>"),c=b[0].childNodes,d=c.length,e=0;d>e;e++)c[e]&&1===c[e].nodeType&&(c[e].outerHTML=c[e].outerHTML.split(k).join(m).split(l).join(n));return b.html()},B=function(a){"string"==typeof a&&(a=a.split(" "));var b=a;angular.forEach(b,function(a){a&&(i=new RegExp("<(/?)("+a+")([\\s>])","gm"),q.push(i))})},C=function(a,c){c=y(c),c=c.replace(/name="(\w+)"/gim,'name="'+a+'::$1"');var d=angular.element(c),e=b(d);e(f),g.append(d)};f.isBindable=function(a){return a+="",-1!==a.indexOf(m)},f.curlify=function(a){return a.split(m).join(k).split(n).join(l)},f.loadSlide=function(d){console.log("%cloading slide "+d.templateUrl+" ","color: #bdc3c7"),u(d.templateUrl),s.slideCount+=1;var e=c.defer(),g="{val}.{ext}".supplant({val:d.templateUrl,ext:f.extension||"xml"});return a.get(g).success(function(a){a=x(a),angular.forEach(w,function(b){a=b(a)}),a=y(a),a=A(a),a=z(a),a="<!-- "+d.templateUrl+" -->"+o+a;var c=angular.element(a),h=b(c);h(d.targetScope),d.targetEl.append(c),f.loadVirtuals(a,g).then(function(){console.log("%cvirtuals loaded for "+d.templateUrl,"color: #3498db"),e.resolve()}),v(d.templateUrl)}),e.promise},f.loadVirtuals=function(b){var d=c.defer(),e=b.replace(/<!--[\s\S]*?-->/g,""),g=e.match(/([\w\.\/]+)(?=::)/gim);if(g){var h=0;angular.forEach(g,function(b){if(!r[b]){h+=1,u(b),s.virtualCount+=1,r[b]=!0;var c=".xml";a.get(b+c).success(function(a){var c=a.match(/xmlns\="(.*?)(?=")/gim);if(!c)throw new Error('missing require "xmlns" attribute');var e=c[0].split("/").pop();switch(e){case"model":var g=hb.fromXML(a);f.set(b,g);break;case"commands":C(b,a)}f.loadVirtuals(a,b).then(function(){d.resolve()}),v(b)})}0===h&&d.resolve()})}else d.resolve();return d.promise},f.parseRegisteredTags=y,f.incCounter=u,f.decCounter=v,g.addClass(j+"cloak"),B(["exec","log","events","event","commands","command","functions","function","properties","listeners","button","slide","mixins","mixin","view","eval","virtual","script","style","link","listener","image","strings"]),f.$watch("url",function(a){if(a){s.startTime=Date.now(),console.log("%c APPLICATION START ","background: #2980b9; color: #fff"),f.$broadcast(d.APP_INIT),f.loadSlide({templateUrl:a,targetScope:f,targetEl:g}).then(function(){});var b,c=f.$watch(function(){e.cancel(b),b=e(function(){1>p&&(c(),console.log("%c %s ","background: #1abc9c; color: #fff; display:block; width: 200px","SLIDE READY",a),f.$broadcast(d.APP_READY),g.removeClass(j+"cloak"),s.endTime=Date.now(),s.totalTime=s.endTime-s.startTime,console.log("%c APPLICATION READY ","background: #27ae60; color: #fff; display:block;"),console.log(""),console.log("%cAPPLICATION REPORT","border-bottom: 1px solid #34495e; color: #666; display:block;"),console.log("%ctime: "+s.totalTime,"color: #34495e; display:block"),console.log("%cslide count: "+s.slideCount,"color: #34495e; display:block"),console.log("%cvirtual count: "+s.virtualCount,"color: #34495e; display:block"),console.log(""),f.$root.$emit("ready"))},0)})}})}]}}]),angular.module("certiport").directive("simButton",function(){return{restrict:"AE",link:function(a,b,c){b.text(c.label)}}}),angular.module("certiport").directive("simImage",["$compile",function(a){return{restrict:"AE",scope:!0,link:function(b,c,d){var e='<img ng-src="{{src}}" ondragstart="return false" />',f=angular.element(e),g=a(f);g(b),c.append(f),b.watch(d.src,function(a){b.src=a,b.incCounter(d.src),f.bind("load",function(){b.decCounter(d.src),b.$$phase||b.$apply()})})}}}]),angular.module("certiport").directive("simSlide",["$log",function(a){return{restrict:"AE",scope:!0,controller:["$scope","$element","$attrs",function(b,c,e){var f="slide_"+b.$id;c.addClass(f),b.properties={},b.functions={},b.registerFunction=function(a,c){b.functions[a]=c},b.invoke=function(a){if("function"==typeof b.functions[a]){var c=b,d=c.getMerged("properties");b.functions[a](c,d)}},b.parseFunctions=function(c){c=c||"";var d,e,f,g=c.match(/(<%=?)((.|\n)*?)(%>)/gim),h=Function;return angular.forEach(g,function(g){d=g.substring(3,g.length-2).trim(),d.match(/\w+\./im)||(d="this."+d);try{e=new h("return ("+d+");").apply(b)}catch(i){try{e=new h("return ("+d+");").apply(b.functions)}catch(i){try{e=new h("return ("+d+");").apply(window)}catch(i){a.warn("Could not invoke: "+d)}}}g=g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),f=new RegExp(g,"im"),c=c.replace(f,e||"")}),c},b.getMerged=function(a){for(var c=[{}],d=b;d.$parent&&(d=d.$parent,d[a]);)c.push(d[a]);return c.push(b[a]),angular.extend.apply(null,c)},b.watch(e.url,function(a){b.$$url=a,b.loadSlide({templateUrl:a,targetEl:c,targetScope:b}).then(function(){var c=b,e=c.getMerged("properties");window.console.log("%cslide loaded "+a,"color: #8e44ad"),b.$broadcast(d.SLIDE_INIT,c,e);var f=b.$on(d.APP_READY,function(){f();var c=b,e=c.getMerged("properties");window.console.log("%c %s ","background: #1abc9c; color: #fff; display:block","SLIDE READY",a),b.$broadcast(d.SLIDE_READY,c,e)})})})}]}}]),angular.module("certiport").directive("simEval",["$interpolate",function(a){return{restrict:"AE",link:function(b,c){var d=c.text();d=b.curlify(d),b.registerAction(function(c,e){var f=a(d),g=f(e);console.log("whoisscope",b.functions.uppercase,g);var h=Function,i=new h("return ("+g+");").apply(b);return void 0===i?i:void 0})}}}]),angular.module("certiport").directive("simExec",["$interpolate","$rootScope",function(a,b){return{restrict:"AE",link:function(c,d,e){var f=d.text();f=c.curlify(f),c.registerAction(function(c,d){var g=a(f),h=g(d),i=hb.fromJson(h);return b.$broadcast(e.command,c,i),i}),d.empty()}}}]),angular.module("certiport").directive("simLog",["$rootScope","$interpolate",function(a,b){return{restrict:"AE",link:function(a,c,d){var e=c.text();e=a.curlify(e),a.registerAction(function(a,c){var f=b(e),g=f(c);g=a.parseFunctions(g),d.debug?console.log("%c%s%c %s","background: #e67e22; color: #fff; display:block","[DEBUG::"+a.$$url+"]","background: #fff; color: #000; display:block",g):console.info(g)}),c.remove()}}}]),angular.module("certiport").directive("simCommand",["$rootScope","$log",function(a,b){var c={};return{restrict:"AE",scope:!0,link:function(a,b){b.remove()},controller:["$scope","$attrs",function(d,e){var f;b.log("%ccommand added: "+e.name,"color: #8e44ad"),d.actions=[],d.registerAction=function(a){d.actions.push(a)},c[e.name]||(c[e.name]=!0,a.$on(e.name,function(a,b,c){angular.forEach(d.actions,function(a){"function"==typeof a&&(f=a(b,c),"undefined"!=typeof f&&(c=f))})}))}]}}]),angular.module("certiport").directive("simFunction",function(){return{restrict:"AE",scope:!0,link:function(a,b){b.remove()},controller:["$scope","$attrs",function(a,b){var c;a.actions=[],a.registerFunction(b.name,function(b,d){angular.forEach(a.actions,function(a){"function"==typeof a&&(c=a(b,d),"undefined"!=typeof c&&(d=c))})}),a.registerAction=function(b){a.actions.push(b)}}]}}),angular.module("certiport").directive("simLink",["$http",function(a){var b={};return{restrict:"AE",controller:["$scope","$element","$attrs",function(c,d,e){var f=".slide_"+c.$id;if(e.href){var g=e.href;if(!b[g]){b[g]=!0;var h="{val}".supplant({val:g});a.get(h).success(function(a){a=a.replace(/([\#\.\D]{1}[A-Za-z]{1}[\w\.\s]+)(,|\{)/g,function(a,b,c){return(f+" "+b.trim()+c).trim()}),d[0].outerHTML="<style>"+a+"</style>"})}}}]}}]),angular.module("certiport").directive("simListener",["$interpolate",function(a){return{restrict:"AE",link:function(a,b){b.remove()},controller:["$scope","$attrs",function(b,c){b.$on(c.on,function(d,e,f){var g=c.handler,h=g.match(/^\w+/im)[0];if(b.functions[h]){var i=g.indexOf("("),j=g.lastIndexOf(")");if(-1===i)g+="(this)";else{var k=g.substr(0,i+1),l=g.substr(i+1);g=g.substr(i,j).match(/\w+/im)?k+"this, "+l:k+"this"+l}g="functions."+g,g=b.curlify(g);var m=a(g),n=m(f);b.$eval(n)}})}]}}]),angular.module("certiport").directive("simMixin",["$http","$compile",function(a,b){var c={};return{restrict:"AE",scope:!0,link:function(a,b){b.remove()},controller:["$scope","$element","$attrs",function(d,e){var f=e.html();if(!c[f]){c[f]=!0;var g="{val}.{ext}".supplant({val:f,ext:"xml"});a.get(g).success(function(a){a=d.parseRegisteredTags(a);var c=angular.element(a),f=b(c);e.append(c),f(d)})}}]}}]),angular.module("certiport").directive("bottom",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.bottom).match(/\d+/),e=String(c.bottom).match(/\D+/)||"px";b.css("position","absolute"),b.css("bottom",d+e)}}}),angular.module("certiport").directive("height",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.height).match(/\d+/),e=String(c.height).match(/\D+/)||"px";b.css("height",d+e)}}}),angular.module("certiport").directive("left",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.left).match(/\d+/),e=String(c.left).match(/\D+/)||"px";b.css("position","absolute"),b.css("left",d+e)}}}),angular.module("certiport").directive("right",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.right).match(/\d+/),e=String(c.right).match(/\D+/)||"px";b.css("position","absolute"),b.css("right",d+e)}}}),angular.module("certiport").directive("top",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.top).match(/\d+/),e=String(c.top).match(/\D+/)||"px";b.css("position","absolute"),b.css("top",d+e)}}}),angular.module("certiport").directive("width",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.width).match(/\d+/),e=String(c.width).match(/\D+/)||"px";b.css("width",d+e)}}}),angular.module("certiport").directive("x",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.x).match(/\d+/),e=String(c.x).match(/\D+/)||"px";b.css("position","absolute"),b.css("left",d+e)}}}),angular.module("certiport").directive("y",function(){return{restrict:"A",link:function(a,b,c){var d=String(c.y).match(/\d+/),e=String(c.y).match(/\D+/)||"px";b.css("position","absolute"),b.css("top",d+e)}}}),angular.module("certiport").directive("simProperties",function(){return{restrict:"AE",link:function(a,b){var c="<props>"+b.html()+"</props>",d=hb.toXML(c),e=hb.fromXML(d);angular.extend(a.properties,e.props),b.remove()}}}),angular.module("certiport").directive("simScript",["$http","$compile",function(a){var b={};return{restrict:"AE",link:function(a,b){b.remove()},controller:["$scope","$element","$attrs",function(c,d,e){if(e.src){var f=e.src;if(!b[f]){b[f]=!0;var g="{val}".supplant({val:f});a.get(g).success(function(a){var b=Function;new b(a).apply(c.functions)})}}else{var h=d.html(),i=Function;new i(h).apply(c.functions)}}]}}]),angular.module("certiport").directive("simStrings",["$http",function(a){return{restrict:"AE",link:function(b,c,d){b.incCounter(d.url);var e=".xml";a.get(d.url+e).success(function(a){var c=hb.fromXML(a);angular.extend(b.$$strings,c),b.loadVirtuals(a).then(function(){b.decCounter(d.url)})}),c.remove()}}}]),angular.module("certiport").directive("simStyle",function(){return{restrict:"AE",controller:["$scope","$element","$attrs",function(a,b){var c=".slide_"+a.$id,d=b.html();d=d.replace(/([\#\.\D]{1}[A-Za-z]{1}[\w\.\s]+)(,|\{)/g,function(a,b,d){return(c+" "+b.trim()+d).trim()}),b[0].outerHTML="<style>"+d+"</style>"}]}}),angular.module("certiport").directive("backgroundColor",function(){return{restrict:"A",link:function(a,b,c){b.css("backgroundColor",c.backgroundColor)}}}),angular.module("certiport").directive("simVirtual",function(){return{restrict:"AE",link:function(a,b){b.remove()}}})}({},function(){return this}());