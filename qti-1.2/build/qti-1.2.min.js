/*
* qti-1.2-engine 0.1.0
*/
angular.module("qti",["ngSanitize"]),angular.module("qti").constant("ATTR_MAP",{fontsize:"font-size",fontface:"font-family",backgroundColor:"background-color",width:"width",height:"height"}),angular.module("qti").directive("assessment",function(){return{restrict:"E",scope:!0,transclude:!0,templateUrl:"templates/assessment.html",link:function(a,b,c){a.assessment={id:c.ident,title:c.title}}}}),angular.module("qti").directive("qtiEngine",["$http","$compile","helpers",function(a,b,c){function d(a){return a.split(" ").join("__SPACE__")}function e(a){return a.split(" ").join("__TAB__")}function f(a){for(var b,f,g,h,i=c.strToXML(a),j=i.querySelectorAll("mattext"),k=0;k<j.length;k++){b=j[k],f=b.childNodes;for(var l=0;l<f.length;l++)g=f[l],3===g.nodeType&&(h=g.nodeValue.replace(/\s{2,}/gim,d),h=h.replace(/\t{2,}/gim,e),g.nodeValue=h)}var m=new XMLSerializer;return a=m.serializeToString(i),a=a.split("__SPACE__").join("&nbsp;&#8203;"),a=a.split("__TAB__").join("&nbsp;&nbsp;&nbsp;&#8203;")}function g(a){return a.split("<![CDATA[").join("").split("]]>").join("")}function h(a){return a.replace(/<dyn type="text\/groovy">(\s?)+return(\s?)+((.|\n)*?)(;?)<\/dyn>/gim,"{{ $3 }}")}function i(a){return a.replace(/\${(\s?)+((.|\n)*?)\}/gim,"{{ system.$2 }}")}return{restrict:"E",scope:!0,link:function(d,e,j){a.get(j.src).then(function(a){{var j=a.data;c.strToXML(j)}j=f(j),j=g(j),j=h(j),j=i(j);var k=b(j),l=k(d);e.append(l)})}}}]),angular.module("qti").directive("flowMat",["ATTR_MAP",function(a){return{restrict:"E",scope:!0,link:function(b,c,d){for(var e in d)a[e]&&c.css(a[e],isNaN(d[e])?d[e]:d[e]+"px")}}}]),angular.module("qti").directive("img",["$compile",function(){return{restrict:"E",scope:!0,link:function(a,b,c){c.hasOwnProperty("align")&&b.css("vertical-align",c.align)}}}]),angular.module("qti").directive("item",["$sce",function(a){return{restrict:"E",scope:!0,link:function(a,b,c){a.item.questionId=c.ident,a.$broadcast("item::ready")},controller:["$scope",function(b){b.objective=null,b.item={},b.trustHtml=function(b){return a.trustAsHtml(b)}}]}}]),angular.module("qti").directive("matimage",["helpers",function(a){return{restrict:"E",scope:!0,link:function(b,c,d){var e,f;f=a.strToXML("<img />").firstChild;var g;switch(d.valign){case"top":g="top";break;case"bottom":g="bottom";break;default:g="middle"}var h="vertical-align:"+g+";";d.hasOwnProperty("width")&&(h+="width:"+d.width+"px;"),d.hasOwnProperty("height")&&(h+="height:"+d.height+"px;"),d.hasOwnProperty("uri")?f.setAttribute("src",d.uri):d.hasOwnProperty("embedded")&&(e="data:image/jpg;base64,",f.setAttribute("src",e+c.text())),d.hasOwnProperty("alt")&&f.setAttribute("alt",d.alt),f.setAttribute("style",h),c.html(f.outerHTML)}}}]),angular.module("qti").directive("mattext",["$sce",function(){return{restrict:"E",scope:!0,link:function(a,b,c){c.hasOwnProperty("width")&&b.css("width",c.width+"px"),c.hasOwnProperty("height")&&b.css("height",c.height+"px"),c.hasOwnProperty("fontface")&&b.css("font-family",c.fontface),c.hasOwnProperty("fontsize")&&b.css("font-size",c.fontsize+"px")}}}]),angular.module("qti").directive("objectives",function(){return{restrict:"E",link:function(a,b,c){a.objectives[c.ident]=b[0].querySelector("mattext").innerHTML,b[0].outerHTML=null,a.$on("item::ready",function(){})},controller:["$scope",function(a){a.objectives=a.objectives||{}}]}}),angular.module("qti").directive("p",["$compile",function(a){function b(a){var b={};if(a)for(var c,d,e,f=a.split(";"),g=0;g<f.length;g+=1)c=f[g].split(":"),d=(c[0]+"").trim(),e=(c[1]+"").trim(),"interval"===d?b[d]=Number(e):"tabset"===d?b[d]=JSON.parse('{"list": ['+e+"]}").list:"alignment"===d&&(b[d]=e.match(/\w+/gim),1===b[d].length&&(b[d]=b[d][0]));return b}return{restrict:"E",scope:!0,link:function(c,d,e){var f,g,h=b(e.tabStops),i=d.html();if(h.hasOwnProperty("interval"))i=i.split("	").join('<span style="padding-right:'+h.interval+'in"></span>'),i="<div>"+i+"</div>",f=a(i),g=f(c),d.empty(),d.append(g);else if(h.hasOwnProperty("tabset")){var j="";i=i.split("	");for(var k=0;k<i.length;k+=1)j+=i[k]+'<span style="padding-right:'+h.tabset[k]+'in"></span>';i="<div>"+j+"</div>",f=a(i),g=f(c),d.empty(),d.append(g)}}}}]),angular.module("qti").directive("presentation",["ATTR_MAP",function(a){return{restrict:"E",transclude:!0,templateUrl:"templates/presentation.html",link:function(b,c,d){var e=c[0].querySelector("mattext");e&&(b.item.question=e.innerHTML);for(var f in d)a[f]&&c.css(a[f],isNaN(d[f])?d[f]:d[f]+"px");b.$on("item::ready",function(){})},controller:["$scope",function(){}]}}]),angular.module("qti").directive("responseLid",function(){return{restrict:"E",scope:!0,transclude:!0,templateUrl:"templates/question-type.html",link:function(a,b,c){a.item.type=c.rcardinality},controller:["$scope",function(){}]}}),angular.module("qti").filter("type",function(){return function(a){switch(a){case"multiple":return"Matching"}return"One Correct Option"}}),angular.module("qti").service("helpers",function(){this.strToXML=function(a){var b,c;return window.DOMParser?(b=new DOMParser,c=b.parseFromString(a,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)),c}});